rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Checks if the request is authenticated.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Checks if the authenticated user's UID matches the provided userId.
     */
    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }

    /**
     * @description Checks if the authenticated user's UID matches the userId and the resource exists.
     */
    function isExistingOwner(userId) {
        return isOwner(userId) && exists(resource);
    }

    /**
     * @description Rules for user profiles.
     * @path /users/{userId}
     * @allow (create) User with UID 'user123' can create their profile at /users/user123.
     * @deny (create) User with UID 'user123' cannot create a profile at /users/user456.
     * @allow (get) User with UID 'user123' can read their profile at /users/user123.
     * @deny (get) User with UID 'user123' cannot read another user's profile at /users/user456.
     * @allow (update) User with UID 'user123' can update their profile at /users/user123.
     * @deny (update) User with UID 'user123' cannot update another user's profile at /users/user456.
     * @allow (delete) User with UID 'user123' can delete their profile at /users/user123.
     * @deny (delete) User with UID 'user123' cannot delete another user's profile at /users/user456.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userId} {
      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId);
      allow delete: if isOwner(userId);
    }

    /**
     * @description Rules for tech projects under a user profile.
     * @path /users/{userId}/tech_projects/{techProjectId}
     * @allow (create) User with UID 'user123' can create a tech project under /users/user123/tech_projects.
     * @deny (create) User with UID 'user123' cannot create a tech project under /users/user456/tech_projects.
     * @allow (get) User with UID 'user123' can read their tech project under /users/user123/tech_projects.
     * @deny (get) User with UID 'user123' cannot read another user's tech project under /users/user456/tech_projects.
     * @allow (update) User with UID 'user123' can update their tech project under /users/user123/tech_projects.
     * @deny (update) User with UID 'user123' cannot update another user's tech project under /users/user456/tech_projects.
     * @allow (delete) User with UID 'user123' can delete their tech project under /users/user123/tech_projects.
     * @deny (delete) User with UID 'user123' cannot delete another user's tech project under /users/user456/tech_projects.
     * @principle Enforces document ownership and relational integrity.
     */
    match /users/{userId}/tech_projects/{techProjectId} {
      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId);
      allow delete: if isOwner(userId);
    }

    /**
     * @description Rules for singing performances under a user profile.
     * @path /users/{userId}/singing_performances/{singingPerformanceId}
     * @allow (create) User with UID 'user123' can create a singing performance under /users/user123/singing_performances.
     * @deny (create) User with UID 'user123' cannot create a singing performance under /users/user456/singing_performances.
     * @allow (get) User with UID 'user123' can read their singing performance under /users/user123/singing_performances.
     * @deny (get) User with UID 'user123' cannot read another user's singing performance under /users/user456/singing_performances.
     * @allow (update) User with UID 'user123' can update their singing performance under /users/user123/singing_performances.
     * @deny (update) User with UID 'user123' cannot update another user's singing performance under /users/user456/singing_performances.
     * @allow (delete) User with UID 'user123' can delete their singing performance under /users/user123/singing_performances.
     * @deny (delete) User with UID 'user123' cannot delete another user's singing performance under /users/user456/singing_performances.
     * @principle Enforces document ownership and relational integrity.
     */
    match /users/{userId}/singing_performances/{singingPerformanceId} {
      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId);
      allow delete: if isOwner(userId);
    }

    /**
     * @description Rules for piano performances under a user profile.
     * @path /users/{userId}/piano_performances/{pianoPerformanceId}
     * @allow (create) User with UID 'user123' can create a piano performance under /users/user123/piano_performances.
     * @deny (create) User with UID 'user123' cannot create a piano performance under /users/user456/piano_performances.
     * @allow (get) User with UID 'user123' can read their piano performance under /users/user123/piano_performances.
     * @deny (get) User with UID 'user123' cannot read another user's piano performance under /users/user456/piano_performances.
     * @allow (update) User with UID 'user123' can update their piano performance under /users/user123/piano_performances.
     * @deny (update) User with UID 'user123' cannot update another user's piano performance under /users/user456/piano_performances.
     * @allow (delete) User with UID 'user123' can delete their piano performance under /users/user123/piano_performances.
     * @deny (delete) User with UID 'user123' cannot delete another user's piano performance under /users/user456/piano_performances.
     * @principle Enforces document ownership and relational integrity.
     */
    match /users/{userId}/piano_performances/{pianoPerformanceId} {
      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId);
      allow delete: if isOwner(userId);
    }

    /**
     * @description Rules for swimming achievements under a user profile.
     * @path /users/{userId}/swimming_achievements/{swimmingAchievementId}
     * @allow (create) User with UID 'user123' can create a swimming achievement under /users/user123/swimming_achievements.
     * @deny (create) User with UID 'user123' cannot create a swimming achievement under /users/user456/swimming_achievements.
     * @allow (get) User with UID 'user123' can read their swimming achievement under /users/user123/swimming_achievements.
     * @deny (get) User with UID 'user123' cannot read another user's swimming achievement under /users/user456/swimming_achievements.
     * @allow (update) User with UID 'user123' can update their swimming achievement under /users/user123/swimming_achievements.
     * @deny (update) User with UID 'user123' cannot update another user's swimming achievement under /users/user456/swimming_achievements.
     * @allow (delete) User with UID 'user123' can delete their swimming achievement under /users/user123/swimming_achievements.
     * @deny (delete) User with UID 'user123' cannot delete another user's swimming achievement under /users/user456/swimming_achievements.
     * @principle Enforces document ownership and relational integrity.
     */
    match /users/{userId}/swimming_achievements/{swimmingAchievementId} {
      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId);
      allow delete: if isOwner(userId);
    }

    /**
     * @description Rules for badminton highlights under a user profile.
     * @path /users/{userId}/badminton_highlights/{badmintonHighlightId}
     * @allow (create) User with UID 'user123' can create a badminton highlight under /users/user123/badminton_highlights.
     * @deny (create) User with UID 'user123' cannot create a badminton highlight under /users/user456/badminton_highlights.
     * @allow (get) User with UID 'user123' can read their badminton highlight under /users/user123/badminton_highlights.
     * @deny (get) User with UID 'user123' cannot read another user's badminton highlight under /users/user456/badminton_highlights.
     * @allow (update) User with UID 'user123' can update their badminton highlight under /users/user123/badminton_highlights.
     * @deny (update) User with UID 'user123' cannot update another user's badminton highlight under /users/user456/badminton_highlights.
     * @allow (delete) User with UID 'user123' can delete their badminton highlight under /users/user123/badminton_highlights.
     * @deny (delete) User with UID 'user123' cannot delete another user's badminton highlight under /users/user456/badminton_highlights.
     * @principle Enforces document ownership and relational integrity.
     */
    match /users/{userId}/badminton_highlights/{badmintonHighlightId} {
      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId);
      allow delete: if isOwner(userId);
    }

    /**
     * @description Rules for contact form submissions.
     * @path /contact_form_submissions/{contactFormSubmissionId}
     * @allow (get) Anyone can read a contact form submission.
     * @allow (list) Anyone can list contact form submissions.
     * @allow (create) Anyone can create a contact form submission.
     * @deny (update) No one can update a contact form submission.
     * @deny (delete) No one can delete a contact form submission.
     * @principle Publicly accessible, relying on Firebase App Check for abuse prevention.
     */
    match /contact_form_submissions/{contactFormSubmissionId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if false;
      allow delete: if false;
    }

     /**
     * @description Rules for website requests.
     * @path /website_requests/{websiteRequestId}
     * @allow (get) Anyone can read a website request.
     * @allow (list) Anyone can list website requests.
     * @allow (create) Anyone can create a website request.
     * @deny (update) No one can update a website request.
     * @deny (delete) No one can delete a website request.
     * @principle Publicly accessible, relying on Firebase App Check for abuse prevention.
     */
    match /website_requests/{websiteRequestId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if false;
      allow delete: if false;
    }
  }
}